<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conciliação de NF-e</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .loader {
      border: 5px solid #f3f3f3; /* Light grey */
      border-top: 5px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .divergencia-preco { background-color: #fef9c3; } /* yellow-100 */
    .divergencia-qtd { background-color: #fee2e2; } /* red-100 */
    .item-ok { background-color: #dcfce7; } /* green-100 */
    .item-cortado { background-color: #e5e7eb; text-decoration: line-through; } /* gray-200 */

    /* Estilos para o multi-select (Select2) */
    .select2-container--default .select2-selection--multiple {
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
    }
    .select2-container .select2-selection--multiple {
      min-height: 38px;
    }
  </style>
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 md:p-6 lg:p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Conciliação de Cotação vs. Nota Fiscal</h1>

    <div id="ConciliacaoNFScript_feedback" class="mb-4"></div>
    <div id="ConciliacaoNFScript_loader" class="hidden text-center">
      <div class="loader"></div>
      <p class="text-gray-600">Carregando...</p>
    </div>

    <!-- Seção de Seleção -->
    <div id="ConciliacaoNFScript_secaoSelecao" class="bg-white p-6 rounded-lg shadow-md mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <div>
          <label for="ConciliacaoNFScript_selectNF" class="block text-sm font-medium text-gray-700 mb-1">1. Selecione a(s) Nota(s) Fiscal(is):</label>
          <select id="ConciliacaoNFScript_selectNF" multiple="multiple" class="block w-full mt-1">
            </select>
          <p class="text-xs text-gray-500 mt-1">Selecione uma NF para ver as cotações compatíveis.</p>
        </div>

        <div>
          <label for="ConciliacaoNFScript_selectCotacao" class="block text-sm font-medium text-gray-700 mb-1">2. Selecione a Cotação:</label>
          <select id="ConciliacaoNFScript_selectCotacao" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" disabled>
            <option value="">Aguardando seleção da Nota Fiscal...</option>
          </select>
        </div>

      </div>
      <div class="mt-6 flex justify-end">
        <button id="ConciliacaoNFScript_btnIniciar" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-400">
          Iniciar Conciliação
        </button>
      </div>
    </div>

    <!-- Seção de Resultados -->
    <div id="ConciliacaoNFScript_secaoResultados" class="hidden">
      <!-- Resumo da Conciliação -->
      <div id="ConciliacaoNFScript_resumo" class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h2 class="text-xl font-bold text-gray-700 mb-4">Resumo da Conciliação</h2>
        <div id="ConciliacaoNFScript_conteudoResumo" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
          <!-- O conteúdo será preenchido via JS -->
        </div>
      </div>
      
      <!-- Detalhes dos Itens -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold text-gray-700 mb-4">Análise de Itens</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item da Cotação</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd / Preço (Cotação)</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">Item da NF Correspondente</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd / Preço (NF)</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              </tr>
            </thead>
            <tbody id="ConciliacaoNFScript_corpoTabelaResultados" class="bg-white divide-y divide-gray-200">
              <!-- Linhas da tabela serão preenchidas via JS -->
            </tbody>
          </table>
        </div>
        <div class="mt-6 flex justify-end">
           <button id="ConciliacaoNFScript_btnCancelar" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 mr-4">
            Cancelar
          </button>
          <button id="ConciliacaoNFScript_btnConfirmar" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400">
            Confirmar e Salvar Conciliação
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery e Select2 JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  
  <?!= App_incluirHtml('ConciliacaoNFScript', true) ?>
</body>
</html>
